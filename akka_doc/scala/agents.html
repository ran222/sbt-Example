<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>Agents (Scala) &mdash; Akka Documentation</title>
    <link rel="stylesheet" href="../_static/style.css" tppabs="http://www.gtan.com/akka_doc/_static/style.css" type="text/css"/>
    <link rel="stylesheet" href="../_static/pygments.css" tppabs="http://www.gtan.com/akka_doc/_static/pygments.css" type="text/css"/>
    <link rel="stylesheet" href="../_static/prettify.css" tppabs="http://www.gtan.com/akka_doc/_static/prettify.css" type="text/css"/>
    <link rel="stylesheet" href="../_static/base.css" tppabs="http://www.gtan.com/akka_doc/_static/base.css" type="text/css"/>
    <link rel="stylesheet" href="../_static/docs.css" tppabs="http://www.gtan.com/akka_doc/_static/docs.css" type="text/css"/>
    <link rel="stylesheet" href="../../../fonts.googleapis.com/css-family=Exo-300,400,600,700.css" tppabs="http://fonts.googleapis.com/css?family=Exo:300,400,600,700" type="text/css"/>
    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:true
        };
    </script>
    <script type="text/javascript" src="../_static/jquery.js" tppabs="http://www.gtan.com/akka_doc/_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js" tppabs="http://www.gtan.com/akka_doc/_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js" tppabs="http://www.gtan.com/akka_doc/_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/toc.js" tppabs="http://www.gtan.com/akka_doc/_static/toc.js"></script>
    <script type="text/javascript" src="../_static/prettify.js" tppabs="http://www.gtan.com/akka_doc/_static/prettify.js"></script>
    <script type="text/javascript" src="../_static/highlightCode.js" tppabs="http://www.gtan.com/akka_doc/_static/highlightCode.js"></script>
    <script type="text/javascript" src="../_static/effects.core.js" tppabs="http://www.gtan.com/akka_doc/_static/effects.core.js"></script>
    <script type="text/javascript" src="../_static/effects.highlight.js" tppabs="http://www.gtan.com/akka_doc/_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../_static/scrollTo.js" tppabs="http://www.gtan.com/akka_doc/_static/scrollTo.js"></script>
    <script type="text/javascript" src="../_static/contentsFix.js" tppabs="http://www.gtan.com/akka_doc/_static/contentsFix.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../index.html"/>
    <link rel="up" title="Scala API" href="index.html"/>
    <link rel="next" title="Transactors (Scala)" href="transactors.html"/>
    <link rel="prev" title="Software Transactional Memory (Scala)" href="stm.html"/>
</head>
<body>
<div class="navbar">
    <div class="navbar-inner">
        <div class="container">
            <div class="navbar-logo">
                <a href="javascript:if(confirm('http://akka.io/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/'" tppabs="http://akka.io/"><img src="../_static/logo-small.png" tppabs="http://www.gtan.com/akka_doc/_static/logo-small.png"/></a>
            </div>
            <ul class="nav">
                <li><a href="javascript:if(confirm('http://akka.io/docs  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/docs'" tppabs="http://akka.io/docs">Documentation</a></li>
                <li><a href="javascript:if(confirm('http://akka.io/downloads  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/downloads'" tppabs="http://akka.io/downloads">Download</a></li>
                <li><a href="javascript:if(confirm('http://groups.google.com/group/akka-user  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://groups.google.com/group/akka-user'" tppabs="http://groups.google.com/group/akka-user">Mailing List</a></li>
                <li><a href="javascript:if(confirm('http://github.com/akka/akka  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://github.com/akka/akka'" tppabs="http://github.com/akka/akka">Code</a></li>
                <li><a href="javascript:if(confirm('http://typesafe.com/products/typesafe-subscription  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://typesafe.com/products/typesafe-subscription'" tppabs="http://typesafe.com/products/typesafe-subscription">Commercial Support</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="main">
<div class="container">
    <div class="page-title">Agents (Scala)</div>
    <div class="pdf-link"><a href="javascript:if(confirm('http://www.gtan.com/akka_doc/Akka.pdf  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ·şÎñÆ÷±¨¸æ¸ÃÎÄ¼şÎ´ÕÒµ½¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://www.gtan.com/akka_doc/Akka.pdf'" tppabs="http://www.gtan.com/akka_doc/Akka.pdf"><img src="../_static/pdf-icon.png" tppabs="http://www.gtan.com/akka_doc/_static/pdf-icon.png" style="height: 40px;"/></a></div>
</div>
<div class="main-container">
<div class="container">
<div class="row">
    <div class="span12">
        <ul class="breadcrumb">
            <li>
                <span class="divider">|</span> <a href="transactors.html" tppabs="http://www.gtan.com/akka_doc/scala/transactors.html">Transactors (Scala)</a> <span class="divider">Â»</span>
            </li>
            <li>
                <a href="../index.html" tppabs="http://www.gtan.com/akka_doc/index.html">ç›®å½•</a>
            </li>
            <li>
                <span class="divider">Â«</span> <a href="stm.html" tppabs="http://www.gtan.com/akka_doc/scala/stm.html">è½¯ä»¶äº‹åŠ¡å†…å­˜STM (Scala)</a> <span class="divider">|</span>
            </li>
            <li>
                ç‰ˆæœ¬ 2.0
            </li>
        </ul>
    </div>
</div>
<div class="row">
    <div class="span9">

        <div class="section" id="agents-scala">
            <span id="id1"></span>

            <h1>Agents (Scala)</h1>

            <p>Akkaä¸­çš„AgentåŒæ ·ä¹Ÿæ˜¯ <a class="reference external" href="javascript:if(confirm('http://clojure.org/agents  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://clojure.org/agents'" tppabs="http://clojure.org/agents">Clojure agent</a> çš„å±±å¯¨ç‰ˆ.</p>

            <p>Agent æä¾›å¯¹ç‹¬ç«‹çš„å†…å­˜ä½ç½®çš„å¼‚æ­¥ä¿®æ”¹. Agentåœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ç»‘å®šåˆ°ä¸€ä¸ªå­˜å‚¨ä½ç½®ï¼Œå¯¹è¿™ä¸ªå­˜å‚¨ä½ç½®çš„æ•°æ®çš„ä¿®æ”¹ä»…å…è®¸åœ¨ä¸€ä¸ªæ“ä½œä¸­å‘ç”Ÿã€‚
                å¯¹å…¶è¿›è¡Œä¿®æ”¹çš„æ“ä½œæ˜¯å‡½æ•°ï¼Œè¯¥å‡½æ•°è¢«å¼‚æ­¥åœ°åº”ç”¨äºAgentçš„çŠ¶æ€ï¼Œå…¶è¿”å›å€¼æˆä¸ºAgentçš„æ–°çŠ¶æ€ã€‚ Agentçš„çŠ¶æ€åº”è¯¥æ˜¯ä¸å¯å˜çš„ã€‚</p>

            <p>è™½ç„¶å¯¹Agentçš„ä¿®æ”¹æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯å…¶çŠ¶æ€æ€»æ˜¯å¯ä»¥éšæ—¶è¢«ä»»ä½•çº¿ç¨‹ (é€šè¿‡ <tt class="docutils literal"><span class="pre">get</span></tt> æˆ–
                <tt class="docutils literal"><span class="pre">apply</span></tt>)æ¥è·å¾—è€Œä¸éœ€è¦å‘é€æ¶ˆæ¯ã€‚</p>

            <p>Agentæ˜¯æ´»åŠ¨çš„. å¯¹æ‰€æœ‰agentçš„æ›´æ–°æ“ä½œåœ¨ä¸€ä¸ªçº¿ç¨‹æ± çš„ä¸åŒçº¿ç¨‹ä¸­å¹¶å‘æ‰§è¡Œã€‚åœ¨æ¯ä¸€ä¸ªæ—¶åˆ»ï¼Œæ¯ä¸€ä¸ªAgentæœ€å¤šåªæœ‰ä¸€ä¸ª <tt class="docutils literal"><span class="pre">send</span></tt> è¢«æ‰§è¡Œ.
                ä»æŸä¸ªçº¿ç¨‹æ´¾å‘åˆ°agentä¸Šçš„æ“ä½œçš„æ‰§è¡Œæ¬¡åºä¸å…¶å‘é€çš„æ¬¡åºä¸€è‡´ï¼Œä½†æœ‰å¯èƒ½ä¸ä»å…¶å®ƒï¼ˆçº¿ç¨‹ï¼‰æºæ´¾å‘æ¥çš„æ“ä½œäº¤ç»‡åœ¨ä¸€èµ·ã€‚</p>

            <p>å¦‚æœåœ¨äº‹åŠ¡ä¸­ä½¿ç”¨Agent,é‚£ä¹ˆå®ƒå°†æˆä¸ºäº‹åŠ¡çš„åœ¨éƒ¨åˆ†ã€‚Agentä¸Scala STMæ˜¯é›†æˆåœ¨ä¸€èµ·çš„ -- æ‰€æœ‰åœ¨äº‹åŠ¡ä¸­æäº¤çš„æ´¾å‘æ“ä½œéƒ½ç›´åˆ°äº‹åŠ¡è¢«æäº¤æ—¶æ‰æ‰§è¡Œï¼Œåœ¨é‡è¯•æˆ–æ”¾å¼ƒçš„
                æƒ…å†µä¸‹ï¼ŒAgentçš„æ“ä½œå°†è¢«ä¸¢å¼ƒã€‚</p>

            <div class="section" id="creating-and-stopping-agents">
                <h2>åˆ›å»ºå’Œç»ˆæ­¢ Agent</h2>

                <p>åˆ›å»ºAgentæ—¶ï¼Œè°ƒç”¨
                    <tt class="docutils literal"><span class="pre">Agent(value)</span></tt> å¹¶ä¼ å…¥å®ƒçš„åˆå§‹å€¼ï¼š</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.agent.Agent</span>

<span class="k">val</span> <span class="n">agent</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
</pre>
                    </div>
                </div>
                <p>æ³¨æ„åˆ›å»ºAgentéœ€è¦ä¸€ä¸ªéšå¼çš„
                    <tt class="docutils literal"><span class="pre">ActorSystem</span></tt> (æ¥åˆ›å»ºåº•å±‚çš„actor). å‚é˜…
                    <a class="reference internal" href="../general/actor-systems.html#actor-systems" tppabs="http://www.gtan.com/akka_doc/general/actor-systems.html#actor-systems"><em>Actorç³»ç»Ÿ</em></a> è·å–å…³äºactorç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ã€‚
                    åˆ›å»º Agent æ—¶ ActorSystem å¯ä»¥åœ¨éšå¼ä½œç”¨åŸŸå†…:</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.agent.Agent</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;app&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">agent</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
</pre>
                    </div>
                </div>
                <p>æˆ–è€…æ˜¾å¼åœ°æŒ‡å®š:</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.agent.Agent</span>

<span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;app&quot;</span><span class="o">)</span>

<span class="k">val</span> <span class="n">agent</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">5</span><span class="o">)(</span><span class="n">system</span><span class="o">)</span>
</pre>
                    </div>
                </div>
                <p>Agent ä¼šä¸€ç›´è¿è¡Œï¼Œç›´åˆ°ä½ å¯¹å…¶è°ƒç”¨
                    <tt class="docutils literal"><span class="pre">close</span></tt> æ–¹æ³•ã€‚ å…³é—­ä»¥åå°†è¢«gcï¼ˆæˆ–è€…ä½ è¿˜ä»¥æŸç§æ–¹å¼ç»§ç»­æŒæœ‰å®ƒï¼‰ã€‚</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="n">agent</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</pre>
                    </div>
                </div>
            </div>
            <div class="section" id="updating-agents">
                <h2>æ›´æ–° Agent</h2>

                <p>æ›´æ–°Agentæœ‰ä¸¤ç§æ–¹æ³•ï¼š<tt class="docutils literal"><span class="pre">send</span></tt>ä¸€ä¸ªå‡½æ•°æ¥è½¬æ¢å½“å‰çš„å€¼æˆ–ç›´æ¥<tt class="docutils literal"><span class="pre">send</span></tt>ä¸€ä¸ªæ–°å€¼ã€‚æ›´æ–°æ˜¯ä»¥ä¸€ç§â€œå¯åŠ¨ç„¶åå¿˜æ‰â€çš„æ–¹å¼å®Œæˆçš„ï¼Œå”¯ä¸€çš„ä¿è¯æ˜¯å®ƒä¼šè¢«æ‰§è¡Œã€‚
                    è‡³äºä»€ä¹ˆæ—¶å€™æ‰§è¡Œåˆ™æ²¡æœ‰ä¿è¯ã€‚ä¸è¿‡ä»åŒä¸€ä¸ªçº¿ç¨‹å‘åˆ°Agentçš„æ“ä½œå°†è¢«é¡ºåºæ‰§è¡Œã€‚</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="c1">// send ä¸€ä¸ªå€¼</span>
<span class="n">agent</span> <span class="n">send</span> <span class="mi">7</span>

<span class="c1">// send ä¸€ä¸ªå‡½æ•°</span>
<span class="n">agent</span> <span class="n">send</span> <span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">agent</span> <span class="n">send</span> <span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span>
</pre>
                    </div>
                </div>
                <p>ä½ ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ´¾å‘ä¸€ä¸ªå‡½æ•°æ¥æ”¹å˜å†…éƒ¨çŠ¶æ€ã€‚è¿™æ ·å°†ä¸ä½¿ç”¨æ´»åŠ¨çº¿ç¨‹æ± ï¼Œå¯ä»¥ç”¨äºé•¿æ—¶é—´è¿è¡Œæˆ–é˜»å¡çš„æ“ä½œã€‚
                    ç›¸åº”çš„æ–¹æ³•æ˜¯ <tt class="docutils literal"><span class="pre">sendOff</span></tt>
                    ã€‚ ä¸ç®¡ä½¿ç”¨ <tt class="docutils literal"><span class="pre">sendOff</span></tt> è¿˜æ˜¯
                    <tt class="docutils literal"><span class="pre">send</span></tt> éƒ½ä¼šé¡ºåºæ‰§è¡Œã€‚</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="c1">// sendOff ä¸€ä¸ªå‡½æ•°</span>
<span class="n">agent</span> <span class="n">sendOff</span> <span class="o">(</span><span class="n">longRunningOrBlockingFunction</span><span class="o">)</span>
</pre>
                    </div>
                </div>
            </div>
            <div class="section" id="reading-an-agent-s-value">
                <h2>è¯»å– Agent çš„å€¼</h2>

                <p>Agentå¯ä»¥ç”¨ï¼ˆï¼‰è°ƒç”¨æ¥å»å¼•ç”¨ (è·å–Agentçš„å€¼) ï¼š</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">agent</span><span class="o">()</span>
</pre>
                    </div>
                </div>
                <p>æˆ–è€…ä½¿ç”¨ get æ–¹æ³•ï¼š</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get</span>
</pre>
                    </div>
                </div>
                <p>å¯¹Agentçš„å€¼çš„è¯»å–ä¸åŒ…æ‹¬ä»»ä½•æ¶ˆæ¯ä¼ é€’ï¼Œç«‹å³æ‰§è¡Œã€‚æ‰€ä»¥è¯´è™½ç„¶Agentçš„æ›´æ–°çš„å¼‚æ­¥çš„ï¼Œå¯¹å®ƒçš„çŠ¶æ€çš„è¯»å–å´æ˜¯åŒæ­¥çš„ã€‚</p>
            </div>
            <div class="section" id="awaiting-an-agent-s-value">
                <h2>ç­‰å¾…Agentçš„è¿”å›å€¼</h2>

                <p> ä¹Ÿå¯ä»¥åœ¨æ‰€æœ‰å½“å‰æ’é˜Ÿçš„sendè¯·æ±‚éƒ½å®Œæˆä»¥åè¯»å–å€¼ï¼Œä½¿ç”¨ <tt class="docutils literal"><span class="pre">await</span></tt>:</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.util.duration._</span>
<span class="k">import</span> <span class="nn">akka.util.Timeout</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mi">5</span> <span class="n">seconds</span><span class="o">)</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">await</span>
</pre>
                    </div>
                </div>
                <p>ä½ ä¹Ÿå¯ä»¥è·å¾—ä¸€ä¸ªå…³äºè¿™ä¸ªå€¼çš„
                    <tt class="docutils literal"><span class="pre">Future</span></tt> , å®ƒä¼šåœ¨å½“å‰æ’é™¤çš„æ›´æ–°æ“ä½œå®Œæ¯•åå®Œæˆï¼š</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.dispatch.Await</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mi">5</span> <span class="n">seconds</span><span class="o">)</span>
<span class="k">val</span> <span class="n">future</span> <span class="k">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">future</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">future</span><span class="o">,</span> <span class="n">timeout</span><span class="o">.</span><span class="n">duration</span><span class="o">)</span>
</pre>
                    </div>
                </div>
            </div>
            <div class="section" id="transactional-agents">
                <h2>äº‹åŠ¡ä¸­çš„ Agent</h2>

                <p>å¦‚æœåœ¨äº‹åŠ¡ä¸­ä½¿ç”¨Agent,é‚£ä¹ˆå®ƒå°†æˆä¸ºäº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚Agentä¸Scala STMæ˜¯é›†æˆåœ¨ä¸€èµ·çš„ -- æ‰€æœ‰åœ¨äº‹åŠ¡ä¸­æäº¤çš„æ´¾å‘æ“ä½œéƒ½ç›´åˆ°äº‹åŠ¡è¢«æäº¤æ—¶æ‰æ‰§è¡Œï¼Œåœ¨é‡è¯•æˆ–æ”¾å¼ƒçš„
                    æƒ…å†µä¸‹ï¼ŒAgentçš„æ“ä½œå°†è¢«ä¸¢å¼ƒã€‚ è§ä¸‹ä¾‹ï¼š</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">import</span> <span class="nn">akka.agent.Agent</span>
<span class="k">import</span> <span class="nn">akka.util.duration._</span>
<span class="k">import</span> <span class="nn">akka.util.Timeout</span>
<span class="k">import</span> <span class="nn">scala.concurrent.stm._</span>

<span class="k">def</span> <span class="n">transfer</span><span class="o">(</span><span class="n">from</span><span class="k">:</span> <span class="kt">Agent</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">to</span><span class="k">:</span> <span class="kt">Agent</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">amount</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
  <span class="n">atomic</span> <span class="o">{</span> <span class="n">txn</span> <span class="k">â‡’</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="n">get</span> <span class="o">&lt;</span> <span class="n">amount</span><span class="o">)</span> <span class="kc">false</span>
    <span class="k">else</span> <span class="o">{</span>
      <span class="n">from</span> <span class="n">send</span> <span class="o">(</span><span class="k">_</span> <span class="o">-</span> <span class="n">amount</span><span class="o">)</span>
      <span class="n">to</span> <span class="n">send</span> <span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="n">amount</span><span class="o">)</span>
      <span class="kc">true</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">from</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
<span class="k">val</span> <span class="n">to</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
<span class="k">val</span> <span class="n">ok</span> <span class="k">=</span> <span class="n">transfer</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">to</span><span class="o">,</span> <span class="mi">50</span><span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mi">5</span> <span class="n">seconds</span><span class="o">)</span>
<span class="k">val</span> <span class="n">fromValue</span> <span class="k">=</span> <span class="n">from</span><span class="o">.</span><span class="n">await</span> <span class="c1">// -&gt; 50</span>
<span class="k">val</span> <span class="n">toValue</span> <span class="k">=</span> <span class="n">to</span><span class="o">.</span><span class="n">await</span> <span class="c1">// -&gt; 70</span>
</pre>
                    </div>
                </div>
            </div>
            <div class="section" id="monadic-usage">
                <h2>Monadic ç”¨æ³•</h2>

                <p>Agent ä¹Ÿæ”¯æŒ monadic æ“ä½œ, è¿™æ ·ä½ å°±å¯ä»¥ç”¨for-comprehensionså¯¹æ“ä½œè¿›è¡Œç»„åˆ. åœ¨ monadic ç”¨æ³•ä¸­, æ—§çš„Agentä¸ä¼šå˜åŒ–ï¼Œè€Œæ˜¯åˆ›å»ºæ–°çš„Agentã€‚
                    è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ &#8216;æŒä¹…&#8217;.</p>

                <p>monadic ç”¨æ³•ç¤ºä¾‹:</p>

                <div class="highlight-scala">
                    <div class="highlight"><pre><span class="k">val</span> <span class="n">agent1</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="k">val</span> <span class="n">agent2</span> <span class="k">=</span> <span class="nc">Agent</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>

<span class="c1">// ç”¨ foreach</span>
<span class="k">var</span> <span class="n">result</span> <span class="k">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="o">(</span><span class="n">value</span> <span class="k">â†</span> <span class="n">agent1</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">result</span> <span class="k">=</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>
<span class="o">}</span>

<span class="c1">// ç”¨ for </span>
<span class="k">val</span> <span class="n">agent3</span> <span class="k">=</span> <span class="k">for</span> <span class="o">(</span><span class="n">value</span> <span class="k">â†</span> <span class="n">agent1</span><span class="o">)</span> <span class="k">yield</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1">// æˆ–è€…ç›´æ¥ç”¨ map </span>
<span class="k">val</span> <span class="n">agent4</span> <span class="k">=</span> <span class="n">agent1</span> <span class="n">map</span> <span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>

<span class="c1">// ç”¨ flatMap</span>
<span class="k">val</span> <span class="n">agent5</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">value1</span> <span class="k">â†</span> <span class="n">agent1</span>
  <span class="n">value2</span> <span class="k">â†</span> <span class="n">agent2</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">value1</span> <span class="o">+</span> <span class="n">value2</span>
</pre>
                    </div>
                </div>
            </div>
        </div>


    </div>
    <div class="span3"><p class="contents-title">Contents</p>

        <div id="scroller-anchor">
            <div id="scroller">
                <div id="toc"></div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
<div class="footer">
    <div class="container">
        <ul>
            <li><h5>Akka</h5></li>
            <li><a href="javascript:if(confirm('http://akka.io/docs  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/docs'" tppabs="http://akka.io/docs">Documentation</a></li>
            <li><a href="javascript:if(confirm('http://akka.io/downloads  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/downloads'" tppabs="http://akka.io/downloads">Downloads</a></li>
            <li><a href="javascript:if(confirm('http://akka.io/news  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/news'" tppabs="http://akka.io/news">News</a></li>
            <li><a href="javascript:if(confirm('http://letitcrash.com/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://letitcrash.com/'" tppabs="http://letitcrash.com/">Blog</a></li>
        </ul>
        <ul>
            <li><h5>Contribute</h5></li>
            <li><a href="javascript:if(confirm('http://github.com/akka/akka  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://github.com/akka/akka'" tppabs="http://github.com/akka/akka">Source Code</a></li>
            <li><a href="javascript:if(confirm('http://groups.google.com/group/akka-user  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://groups.google.com/group/akka-user'" tppabs="http://groups.google.com/group/akka-user">Mailing List</a></li>
            <li><a href="javascript:if(confirm('http://www.assembla.com/spaces/akka/tickets  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://www.assembla.com/spaces/akka/tickets'" tppabs="http://www.assembla.com/spaces/akka/tickets">Report a Bug</a></li>
        </ul>
        <ul>
            <li><h5>Company</h5></li>
            <li><a href="javascript:if(confirm('http://typesafe.com/products/typesafe-subscription  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://typesafe.com/products/typesafe-subscription'" tppabs="http://typesafe.com/products/typesafe-subscription">Commercial Support</a></li>
            <li><a href="javascript:if(confirm('http://akka.io/team  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://akka.io/team'" tppabs="http://akka.io/team">Team</a></li>
            <li><a href="mailto:info@typesafe.com">Contact</a></li>
        </ul>
        <ul>
            <li><img src="../_static/watermark.png" tppabs="http://www.gtan.com/akka_doc/_static/watermark.png" align="center"/></li>
        </ul>
    </div>
    <div class="container copyright">
        <p style="float: left;">
            Â© 2012 <a href="javascript:if(confirm('http://typesafe.com/  \n\n¸ÃÎÄ¼şÎŞ·¨ÓÃ Teleport Ultra ÏÂÔØ, ÒòÎª ËüÊÇÒ»¸öÓò»òÂ·¾¶Íâ²¿±»ÉèÖÃÎªËüµÄÆôÊ¼µØÖ·µÄµØÖ·¡£  \n\nÄãÏëÔÚ·şÎñÆ÷ÉÏ´ò¿ªËü?'))window.location='http://typesafe.com/'" tppabs="http://typesafe.com/">Typesafe Inc.</a>
            <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
        </p>

        <p style="float: right; font-size: 12px;">
            Last updated: Mar 08, 2012
        </p>
    </div>
</div>
<script type="text/javascript">
    $('#toc').toc();
</script>


</body>
</html>
<!-- Localized -->